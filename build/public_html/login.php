<?php
session_start();

if(isset( $_SESSION['user'])){
    header("Location: dashboard");
    die();
}

$title = "TaskMag - Prihlásenie";
require_once (__DIR__."/../resources/src/views/header_includes/head.php");
?>
<body>
<div <div id="mainWrap">
    <div class="container">
        <div class="row">
            <div class="col-md-7 col-lg-8 text-center d-none d-md-block">
                <p class="jumbo">Vitajte späť!</p>
                <div class="svg-image mx-auto d-block">
                    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 717.4 797.1" style="enable-background:new 0 0 717.4 797.1;" xml:space="preserve">
                        <g id="svg-img-user">
                            <path d="M358.7,797.1C160.9,797.1,0,636.2,0,438.4c0-110.4,49.7-212.9,136.4-281.5c1.9-1.5,4.7-1.2,6.3,0.8s1.2,4.7-0.8,6.3
                                c-84.5,66.8-133,166.9-133,274.5c0,192.9,156.9,349.8,349.8,349.8s349.8-157,349.8-349.9c0-123.7-64.6-236.7-170.7-300.7
                                c-2-1.3-2.6-4.1-1.3-6.1c1.3-1.9,3.8-2.6,5.9-1.5c52,31.4,96.8,76.6,127.2,129.2c31.4,54.5,47.8,116.2,47.8,179.1
                                C717.4,636.2,556.5,797.1,358.7,797.1z"/>
                            <path d="M155.8,706c-2.4,0-4.4-2-4.4-4.4c0,0,0,0,0,0V623c0-46.2,101.6-81.3,106-82.8c2.3-0.7,4.8,0.6,5.5,3
                                c0.7,2.2-0.5,4.6-2.7,5.4c-27.8,9.5-100,41.3-100,74.4v78.6C160.2,704,158.3,706,155.8,706z"/>
                            <path d="M236,743.3c-2.5,0-4.4-2-4.4-4.4l0,0v-66.6c-0.1-2.4,1.8-4.5,4.2-4.6c2.4-0.1,4.5,1.8,4.6,4.2c0,0.1,0,0.3,0,0.4v66.6
                                C240.4,741.3,238.5,743.3,236,743.3C236,743.3,236,743.3,236,743.3z"/>
                            <path d="M480.5,745.5c-2.5,0-4.4-2-4.4-4.4l0,0v-66.6c-0.1-2.4,1.8-4.5,4.2-4.6c2.4-0.1,4.5,1.8,4.6,4.2c0,0.1,0,0.3,0,0.4v66.6
                                C484.9,743.5,483,745.5,480.5,745.5C480.5,745.5,480.5,745.5,480.5,745.5z"/>
                            <path d="M358.6,770.1c-2.4,0-4.4-2-4.4-4.4v-68.3c0.1-2.4,2.2-4.3,4.6-4.2c2.3,0.1,4.1,1.9,4.2,4.2v68.3
                                C363,768.2,361,770.1,358.6,770.1C358.6,770.1,358.6,770.1,358.6,770.1z"/>
                            <path d="M297.9,692.5c-2.4,0-4.4-2-4.4-4.4v-79.6c0-2.4,2-4.4,4.4-4.4c0.7,0,1.3,0.1,1.9,0.4l48.3,23.1c2.3,0.9,3.4,3.5,2.4,5.8
                                c-0.9,2.3-3.5,3.4-5.8,2.4c-0.2-0.1-0.3-0.1-0.5-0.2l-42-20V681l42-20c2.2-1.1,4.9-0.1,5.9,2.1c1.1,2.2,0.1,4.9-2.1,5.9
                                l-48.3,23.1C299.2,692.3,298.6,692.5,297.9,692.5z"/>
                            <path d="M356.4,672.5c-11.2,0-20.3-10.8-20.3-24.1s9.1-24.1,20.3-24.1s20.3,10.8,20.3,24.1S367.6,672.5,356.4,672.5z M356.4,633.1
                                c-6.3,0-11.4,6.8-11.4,15.3s5.1,15.3,11.4,15.3s11.4-6.8,11.4-15.3S362.7,633.1,356.4,633.1z"/>
                            <circle cx="385.6" cy="707" r="5.5"/>
                            <circle cx="385.6" cy="752" r="5.5"/>
                            <circle cx="385.6" cy="729.5" r="5.5"/>
                            <path d="M561.3,706c-2.4,0-4.4-2-4.4-4.4c0,0,0,0,0,0V623c0-33.1-72.1-64.9-100-74.4c-2.3-0.7-3.7-3.2-3-5.5
                                c0.7-2.3,3.2-3.7,5.5-3c0.1,0,0.2,0.1,0.3,0.1c4.3,1.5,106,36.6,106,82.8v78.6C565.8,704,563.8,706,561.3,706
                                C561.3,706,561.3,706,561.3,706z"/>
                            <path d="M415,692.5c-0.7,0-1.3-0.1-1.9-0.4l-48.3-23c-2.2-1.1-3.1-3.7-2.1-5.9c1.1-2.2,3.7-3.1,5.9-2.1l42,20v-65.5l-42,20
                                c-2.1,1.2-4.8,0.4-6-1.7c-1.2-2.1-0.4-4.8,1.7-6c0.1-0.1,0.3-0.2,0.5-0.2l48.3-23.1c2.2-1.1,4.9-0.1,5.9,2.1
                                c0.3,0.6,0.4,1.2,0.4,1.9V688C419.4,690.5,417.4,692.5,415,692.5C415,692.5,415,692.5,415,692.5L415,692.5z"/>
                            <path d="M357.5,460.5c-20.7,0-41.7-5.4-62.4-16c-2.2-1.1-3-3.8-1.9-6s3.8-3,6-1.9c19.5,10,39.1,15,58.4,15s39.1-5.1,58.6-15.1
                                c2.2-1,4.9-0.1,5.9,2.1c1,2.1,0.2,4.6-1.8,5.7C399.4,455,378.3,460.5,357.5,460.5z"/>
                            <path d="M438.5,444.7c-53.5,0-72.9-14.4-79.9-25.4c-7,11-26.4,25.4-79.9,25.4c-31,0-54.1-7.5-68.7-22.2
                                c-15.1-15.3-15.1-32.6-15.1-33.3c0.1-2.2,1.9-3.9,4.2-3.8c1.1,0,2.2,0.6,2.9,1.5c1.2,1.5,29,36.7,59.5,13.7
                                c10.5-8,18.3-14.8,24.6-20.2c14.1-12.3,21.9-19,38.1-19c17,0,29.1,9.9,34.5,15.5c5.4-5.5,17.5-15.5,34.5-15.5
                                c16.2,0,24,6.8,38.1,19c6.3,5.4,14,12.2,24.6,20.2l0,0c30.6,23.1,58.4-12.2,59.5-13.7c1.4-1.7,3.9-1.9,5.6-0.5
                                c0.9,0.7,1.4,1.8,1.4,2.9c0,0.7,0,18.1-15.1,33.3C492.6,437.2,469.5,444.7,438.5,444.7z M358.6,403.6L358.6,403.6
                                c2.1,0,3.9,1.8,3.9,3.9c0,0.3,1.4,29.2,76,29.2c28.8,0,50.1-6.7,63.1-19.8c4.3-4.3,7.7-9.4,9.9-15c-14.5,12.3-37.6,22.1-60.6,4.8
                                c-10.8-8.1-18.7-15-25-20.5c-13.5-11.7-19.6-17.1-32.9-17.1c-19.2,0-31.2,15.7-31.3,15.9c-1.5,1.7-4.1,2-5.8,0.5
                                c-0.2-0.2-0.4-0.3-0.5-0.5c-0.1-0.2-12.3-15.9-31.3-15.9c-13.2,0-19.4,5.4-32.9,17.1c-6.3,5.5-14.2,12.4-25,20.5
                                c-22.9,17.4-46,7.5-60.5-4.8c1.6,3.9,3.7,7.6,6.3,10.9c12.3,15.6,35.3,23.9,66.7,23.9c74.5,0,76-29,76-29.2
                                C354.8,405.4,356.5,403.7,358.6,403.6z"/>
                            <path d="M515.7,242.4c-2.4,0-4.3-1.8-4.4-4.2c-3-57.2-52.3-89.7-52.8-90c-2.1-1.3-2.6-4.1-1.3-6.1c1.3-2.1,4.1-2.6,6.1-1.3
                                c2.2,1.4,53.5,35.2,56.8,97c0.1,2.4-1.7,4.5-4.2,4.7L515.7,242.4z"/>
                            <path d="M566.8,283.2c0-12-3.5-21.6-10.3-28.4c-4.8-4.6-10.8-7.9-17.3-9.3c8.3-14.6,26.7-53.7,13.2-93.2
                                c-11.1-32.4-40.5-56.9-88.3-73c-5-24.9-15.1-56-35.7-70.8c-12.3-8.8-26.8-10.8-43.1-6C325.5,20.3,166.6,67.4,139,127.3
                                c-5.6,12.1-5.8,24.2-0.4,36.1l38.9,80.3c-6.8,1.4-13,4.6-17.9,9.4c-6.8,6.8-10.3,16.4-10.3,28.4c0,27.7,23.7,38.9,39.2,41.6
                                c-0.2,11-0.6,64.6-0.8,92.4c-0.1,0.3-0.1,0.6-0.1,0.9c0,19.6,17.3,63.7,45.2,100.7c25.1,33.3,67,72.9,124.6,73.5h1.5
                                c57.6-0.6,99.5-40.2,124.6-73.5c27.9-37.1,45.2-81.2,45.2-100.7c0-0.3,0-0.5-0.1-0.8c-0.2-27.1-0.7-79.7-0.9-90.8
                                C543.2,322.1,566.8,311,566.8,283.2z M476.3,511.9c-24,31.8-63.9,69.7-118.3,70c-54.4-0.2-94.3-38.2-118.3-70
                                c-28.5-37.9-42.4-77.1-43.4-93.6c0-0.1,0-0.1,0-0.2c0.2-32.7,0.9-98.3,0.9-98.8c0-2.3-1.7-4.3-4-4.5c-1.4-0.1-35.2-3.6-35.2-33.3
                                c0-28.8,23.4-29.7,26-29.8l0,0c2.4,0,4.4-2,4.4-4.4c0-0.7-0.2-1.3-0.4-2l-41.6-85.7c-4.2-9.5-4.1-18.9,0.5-28.7
                                C173,74.7,329.1,28.5,387.9,11.1c13.8-4.1,25.4-2.6,35.5,4.6c29.3,21,35.4,82.9,36.5,97.4l-192.3,83.7
                                c-1.9-5.4-5.7-17.9-12.4-45.2c-3.8-15.5-10.9-25.7-21-30.3c-14.5-6.5-29.4,1.2-30,1.5c-2.1,1.2-2.9,3.9-1.6,6.1
                                c1.2,2,3.7,2.8,5.8,1.8c0.1-0.1,11.7-6,22.3-1.3c7.6,3.4,12.9,11.6,16.1,24.3c10.6,43.2,14.4,50.5,14.8,51.2
                                c1.1,2,3.5,2.8,5.6,1.9L466.2,120c1.7-0.7,2.7-2.4,2.7-4.2c-0.5-8.9-1.4-17.7-2.8-26.4c42.2,15.1,68.3,37.2,78.1,65.8
                                c15.3,44.7-15.5,90.9-15.8,91.4c-1.4,2-0.8,4.8,1.2,6.2c0.7,0.5,1.6,0.8,2.5,0.8l0,0c0.1,0,10.8,0.1,18.3,7.6
                                c5.1,5.1,7.7,12.5,7.7,22.1c0,29.7-33.8,33.2-35.2,33.3c-2.3,0.2-4,2.2-4,4.5c0,0.4,0.7,62.3,0.9,95.1c0,0.2,0,0.4,0.1,0.6
                                C519.5,432.2,505.7,472.8,476.3,511.9z"/>
                            <path id="glasses" d="M466.6,286H462c-2.3-23.6-23.3-40.9-47-38.6c-17.9,1.7-32.9,14.5-37.4,31.9c-4.1-4.4-10.2-7.9-18.9-7.9
                                s-14.8,3.4-18.9,7.9c-6-23-29.5-36.7-52.5-30.7c-17.4,4.6-30.2,19.5-31.9,37.5h-4.6c-2.4,0.1-4.3,2.2-4.2,4.6
                                c0.1,2.3,1.9,4.1,4.2,4.2h4.6c2.3,23.6,23.3,41,46.9,38.7c19.7-1.9,35.6-17,38.4-36.6c0.3-0.5,0.4-1,0.5-1.5
                                c0.1-0.6,2.3-15.2,17.4-15.2c14.7,0,17.2,13.7,17.4,15.2c0.1,0.5,0.3,1,0.5,1.5c3.4,23.5,25.2,39.8,48.7,36.4
                                c19.7-2.8,34.8-18.8,36.7-38.5h4.6c2.4-0.1,4.3-2.2,4.2-4.6C470.7,287.9,468.9,286.1,466.6,286L466.6,286z M298.2,324.6
                                c-18.9,0-34.2-15.3-34.2-34.2s15.3-34.2,34.2-34.2c18.9,0,34.2,15.3,34.2,34.2C332.4,309.3,317.1,324.6,298.2,324.6z M419.2,324.6
                                c-18.9,0-34.2-15.3-34.2-34.2s15.3-34.2,34.2-34.2c18.9,0,34.2,15.3,34.2,34.2C453.3,309.3,438,324.6,419.2,324.6L419.2,324.6z"/>
                            <circle cx="298.2" cy="290.5" r="5.5"/>
                            <circle cx="419.1" cy="290.5" r="5.5"/>
                            <path d="M199.6,240h-0.2c-2.4-0.1-4.3-2.2-4.2-4.6c0,0,0,0,0,0c2.1-39.8,35.2-61.6,36.6-62.5c2.1-1.3,4.8-0.7,6.1,1.3
                                c1.3,2.1,0.7,4.8-1.3,6.1l0,0c-0.4,0.3-30.7,20.4-32.6,55.5C203.9,238.2,201.9,240,199.6,240z"/>
                            <path d="M455.5,242.4c-1.2,0-2.4-0.5-3.2-1.4c-16-17.2-40.5-14-40.7-13.9c-2.4,0.4-4.7-1.2-5.1-3.6c-0.4-2.4,1.2-4.7,3.6-5.1
                                c0.1,0,0.2,0,0.3,0c1.2-0.2,29.3-3.8,48.4,16.7c1.7,1.8,1.6,4.6-0.2,6.3C457.7,242,456.6,242.4,455.5,242.4L455.5,242.4z"/>
                            <path d="M255.2,245.1c-1.1,0-2.2-0.4-3-1.2c-1.8-1.7-1.9-4.5-0.2-6.3c19.1-20.5,47.2-16.8,48.4-16.7c2.4,0.3,4.1,2.6,3.8,5
                                s-2.6,4.1-5,3.8l0,0c-0.3,0-24.8-3.1-40.7,13.9C257.6,244.6,256.4,245.1,255.2,245.1z"/>
                            <path d="M374.6,342.7c-2.3-0.8-4.8,0.3-5.7,2.5c-0.2,0.6-2.5,5.7-10.8,5.7s-10.6-5.1-10.8-5.7c-0.9-2.3-3.5-3.4-5.8-2.5
                                c-2.1,0.9-3.3,3.2-2.6,5.5c0.2,0.5,4.3,11.5,19.1,11.5s19-11.1,19.1-11.5C378,346,376.8,343.6,374.6,342.7z"/>
                        </g>
                    </svg>
                </div>
                <p class="title thin primary">Prihláste sa<br>a pokračujte, kde ste prestali.</p>
            </div>
            <div class="col-md-5 col-lg-4 text-center main-wrap rightColumn">
                <div class="go-back-btn"><a href="index.php" title="Naspat na hlavnu stranku"></a></div>
                <div class="logo">
                    <a href="index.php"><img src="assets/img/icons/logo.svg"></a>
                </div>
                <p class="title thin">Prihlásiť sa</p>
                <!--                    errors-->
                <div class="serverSideErrors">
                    <section class="errors">
                        <div id="ajaxErrorsAlert" class=" fade show" role="alert">
                            <div id="ajaxErrors"></div>
                        </div>
                    </section>
                </div>
                <!--                    end of errors-->
                <section class="text-left">
                    <form role="form" method="post" id="_logForm">
                        <div class="form-group putError">
                            <label for="email" class="text-muted form-text" >Email</label>
                            <div class="input-icon">
                                <img src="assets/img/icons/Email.svg">
                            </div>
                            <input class="input-line input-default" type="email" id="email" name="email" value="">
                            <span></span>
                        </div>
                        <div class="form-group putError">
                            <label for="upass" class="form-text text-muted " >Heslo</label>
                            <div class="input-icon">
                                <img class="lock" src="assets/img/icons/Lock.svg">
                            </div>
                            <div class="input-icon-back">
                                <svg class="toggle-password" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 128 81.7" style="enable-background:new 0 0 128 81.7;" xml:space="preserve">
                                        <title>Ukázať / skryť heslo</title>
                                    <g id="pass-visibility">
                                        <path class="st0" d="M64,4.1c18.5,0,34.4,6.7,47.2,19.8c4.4,4.6,8.3,9.8,11.4,15.4c1.1,2,1,4.4-0.3,6.3
            c-3.3,5.1-7.3,9.7-11.7,13.9c-13,12.1-28.4,18.2-45.9,18.2S31.4,71.5,18,59.3c-4.6-4.1-8.7-8.8-12.2-13.8C4.5,43.6,4.4,41,5.5,39
            c3.1-5.5,6.9-10.6,11.3-15.1C29.6,10.7,45.4,4.1,64,4.1 M64,0.1C24.1,0,5.7,29.7,0.7,39.5c-1,1.9-0.9,4.2,0.3,6
            c5.8,9.1,26.3,36.2,63.7,36.2s57-27.2,62.5-36.2c1.1-1.8,1.2-4,0.2-5.9C122.4,29.8,103.9,0,64,0.1L64,0.1z"/>
                                        <path class="st0" d="M63.3,67.6c-15,0-27.1-12.4-27.1-27.7s12.2-27.7,27.1-27.7s27.1,12.4,27.1,27.7S78.3,67.6,63.3,67.6z
             M63.3,14.1c-13.9,0-25.1,11.5-25.1,25.7s11.3,25.7,25.1,25.7S88.4,54,88.4,39.8S77.2,14.1,63.3,14.1z"/>
                                        <path class="st0" d="M48,46.2c-0.5,0-0.9-0.3-1-0.8c-0.1-0.4-2.4-10,2.8-16.6c3.1-4,8.2-6,15.1-6c0.6,0,1,0.4,1,1s-0.4,1-1,1
            c-6.3,0-10.8,1.8-13.5,5.2c-4.6,5.9-2.5,14.9-2.5,15c0.1,0.5-0.2,1.1-0.7,1.2C48.1,46.2,48.1,46.2,48,46.2z"/>
                                    </g>
                                    </svg>
                            </div>
                            <input class="input-line input-pass" type="password" id="upass" name="upass">
                            <span></span>
                        </div>
                        <div id="passwordHelpBlock">
                            <p><small class="form-text text-muted "><a href="forgot-password.php">Zabudli ste heslo?</a></small></p>
                            <p><small class="form-text text-muted "><span>Nemáte ešte účet? </span><a href="registration.php">Registrujte sa.</a></small></p>
                        </div>
                        <button class="btn btn-block mb-5" type="submit" name="login">prihlásiť sa</button>
                    </form>
                </section>
            </div>
        </div>
    </div>
</div>
<script src="./assets/js/vendors.min.js"></script>
<script src="./assets/js/app.min.js"></script>

<script>
    $(document).ready(function(){
        $("input#upass").focus(function(){
            $("path#glasses").css("opacity", "0");
        });
        $("input#upass").focusout(function(){
            $("path#glasses").css("opacity", "1");
        });
    });
</script>

<script>
    // AJAX LOGIN

    var errorBox = $("#ajaxErrorsAlert");
    var errorBoxContent = $("#ajaxErrors");
    var errorMessage = "";

    $(document).ready(function () {

        //form
        var loginForm = $("#_logForm");

        //form validation (jQuery Validation plugin)
        loginForm.validate({
            rules: {                         //rules

                //input names and their rules

                email:{
                    required: true,
                    email: true
                },
                upass:{
                    required: true,
                    rangelength: [8, 20],
                    strongPassword: true
                }
            },
            messages:{                      //messages

                email:{
                    required: "Prosím, zadajte váš email",
                    email: "Zadajte správny tvar emailu napr. meno@priezvisko.sk"
                },
                upass:{
                    required: "Prosím, zadajte heslo",
                    rangelength: "Heslo musí obsahovať minimálne 8 a maximálne 20 znakov"
                }
            },
            submitHandler: function () {

                //if the form is valid
                if (loginForm.valid()){

                    //ajax
                    var method = loginForm.attr('method');

                    $.ajax({
                        url: '../resources/src/scripts/loginUser.php',
                        type: method,
                        dataType: 'JSON',
                        data: loginForm.serialize(),
                        success: function (data) {
                            // This is a callback that runs if the submission was a success.

                            //show some message
                            showMessagesLogin(data.code, data.msg);
                            return false;
                        },

                        error: function () {
                            alert("error");
                            // This is a callback that runs if the submission was not successful.
                        }
                    });

                    return false;
                }
            }
        });

        function showMessagesLogin(code, msg) {
            // if success
            if (code == "200") {

                window.location='dashboard';
                //if some errors
            } else if (code == "404") {
                errorMessage = '<h6>Ooops. Našlo sa pár chýb.</h6>';
                $.each(msg, function (key, value) {
                    errorMessage += ('<p>' + value + '</p>');
                });
                errorBox.addClass("alert alert-danger");
                errorBoxContent.html(errorMessage);
                errorBox.alert();
                //auto-fade alert
                errorBox.fadeTo(5000, 5000).slideUp(5000, function () {
                });
                errorMessage="";
            }
        }

    });

</script>
</body>